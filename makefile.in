COMPILE_FLAGS = -c -Wall -g -std=c++11 -fPIC -o3 -Iinclude
INSTALL_TEMP = install/
INSTALL_TEMP_NOSLASH = install
SRCS = $(shell find svector -name *.cpp)
OBJS = $(addprefix build/,$(SRCS:.cpp=.o))
deps = $(addprefix build/,$(SRCS:.cpp=.d))

all: build/svector/libsvector.so

build/svector/libsvector.so: makefile $(OBJS) | build/svector
	echo $(SRCS)
	 gcc -shared -o build/svector/libsvector.so $(OBJS)

build/svector:
	mkdir -p build/svector

# The symbols $@ and $< are the file being generated and the first dependency respectively
build/%.o: %.cpp | build/svector
	g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o $@ $<

clean:
	rm -r build $(INSTALL_TEMP)lib/libsvector.so $(INSTALL_TEMP)include/svector $(INSTALL_TEMP)share/svector $(INSTALL_TEMP)bin\mkapex

install: $(INSTALL_TEMP)lib/libsvector.so installheaders installtemplate $(INSTALL_TEMP)bin/mkapex
	@echo "Installation complete"

$(INSTALL_DIR):
	mkdir -p "$(INSTALL_DIR)"

$(INSTALL_TEMP): | $(INSTALL_DIR)
	if [ -f $(INSTALL_TEMP_NOSLASH) ] ; then echo "Install link already exists - > continuing"; else ln -s "$(INSTALL_DIR)" $(INSTALL_TEMP_NOSLASH); fi

$(INSTALL_TEMP)lib: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)lib

$(INSTALL_TEMP)lib/libsvector.so: build/libsvector.so | $(INSTALL_TEMP)lib
	cp build/libsvector.so $(INSTALL_TEMP)lib/libsvector.so

installheaders: | $(INSTALL_TEMP)
	cp -r include/ $(INSTALL_TEMP)

installtemplate: | $(INSTALL_TEMP)share/svector
	cp template/Apex++2015/Apex++/*.cpp $(INSTALL_TEMP)share/svector/; cp template/Apex++2015/Apex++/*.h $(INSTALL_TEMP)share/svector/;cp template/Apex++2015/Apex++/makefile $(INSTALL_TEMP)share/svector/

$(INSTALL_TEMP)share/svector: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)share/svector

$(INSTALL_TEMP)bin/mkapex: | $(INSTALL_TEMP)bin
	cp template/mkapex $(INSTALL_TEMP)bin/ && chmod +x $(INSTALL_TEMP)bin/mkapex

$(INSTALL_TEMP)bin: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)bin
