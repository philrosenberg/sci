COMPILE_FLAGS = -c -Wall -g -std=c++11 -fPIC -o3 -Iinclude
INSTALL_TEMP = install/
INSTALL_TEMP_NOSLASH = install

all: build/libsvector.so

build/libsvector.so: makefile build build/svector.o build/memorymap.o build/operators.o build/plotdata.o build/ppfile.o build/sdialog.o build/serr.o build/sframe.o build/smath.o build/sminimiser.o build/splot.o build/sreadwrite.o build/sstring.o build/nc.o build/transforms.o build/svi.o build/undoable.o build/wgdos.o
	 gcc -shared -o build/libsvector.so build/svector.o build/memorymap.o build/operators.o build/plotdata.o build/ppfile.o build/sdialog.o build/serr.o build/sframe.o build/smath.o build/sminimiser.o build/splot.o build/sreadwrite.o build/sstring.o build/nc.o build/transforms.o build/svi.o build/undoable.o build/wgdos.o

build:
	mkdir build

build/svector.o: svector/svector.cpp | build 
	 g++ $(COMPILE_FLAGS) -o build/svector.o svector/svector.cpp

build/memorymap.o: svector/memorymap.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/memorymap.o svector/memorymap.cpp

build/operators.o: svector/operators.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/operators.o svector/operators.cpp

build/plotdata.o: svector/plotdata.cpp | build
	 g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o build/plotdata.o svector/plotdata.cpp

build/ppfile.o: svector/ppfile.cpp | build
	 g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o build/ppfile.o svector/ppfile.cpp

build/sdialog.o: svector/sdialog.cpp | build
	 g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o build/sdialog.o svector/sdialog.cpp

build/serr.o: svector/serr.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/serr.o svector/serr.cpp

build/sframe.o: svector/sframe.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/sframe.o svector/sframe.cpp

build/smath.o: svector/smath.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/smath.o svector/smath.cpp

build/sminimiser.o: svector/sminimiser.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/sminimiser.o svector/sminimiser.cpp

build/splot.o: svector/splot.cpp | build
	 g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o build/splot.o svector/splot.cpp

build/sreadwrite.o: svector/sreadwrite.cpp | build
	 g++ $(COMPILE_FLAGS) `wx-config --cxxflags` -Wno-deprecated -Wno-deprecated-declarations -o build/sreadwrite.o svector/sreadwrite.cpp

build/sstring.o: svector/sstring.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/sstring.o svector/sstring.cpp

build/nc.o: svector/nc.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/nc.o svector/nc.cpp

build/transforms.o: svector/transforms.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/transforms.o svector/transforms.cpp

build/svi.o: svector/svi.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/svi.o svector/svi.cpp

build/undoable.o: svector/undoable.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/undoable.o svector/undoable.cpp

build/wgdos.o: svector/wgdos.cpp | build
	 g++ $(COMPILE_FLAGS) -o build/wgdos.o svector/wgdos.cpp
     
clean:
	rm -r build $(INSTALL_TEMP)lib/libsvector.so $(INSTALL_TEMP)include/svector $(INSTALL_TEMP)share/svector $(INSTALL_TEMP)bin\mkapex

install: $(INSTALL_TEMP)lib/libsvector.so installheaders installtemplate $(INSTALL_TEMP)bin/mkapex
	@echo "Installation complete"

$(INSTALL_DIR):
	mkdir -p "$(INSTALL_DIR)"

$(INSTALL_TEMP): | $(INSTALL_DIR)
	if [ -f $(INSTALL_TEMP_NOSLASH) ] ; then echo "Install link already exists - > continuing"; else ln -s "$(INSTALL_DIR)" $(INSTALL_TEMP_NOSLASH); fi

$(INSTALL_TEMP)lib: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)lib

$(INSTALL_TEMP)lib/libsvector.so: build/libsvector.so | $(INSTALL_TEMP)lib
	cp build/libsvector.so $(INSTALL_TEMP)lib/libsvector.so

installheaders: | $(INSTALL_TEMP)
	cp -r include/ $(INSTALL_TEMP)

installtemplate: | $(INSTALL_TEMP)share/svector
	cp template/Apex++2015/Apex++/*.cpp $(INSTALL_TEMP)share/svector/; cp template/Apex++2015/Apex++/*.h $(INSTALL_TEMP)share/svector/;cp template/Apex++2015/Apex++/makefile $(INSTALL_TEMP)share/svector/

$(INSTALL_TEMP)share/svector: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)share/svector

$(INSTALL_TEMP)bin/mkapex: | $(INSTALL_TEMP)bin
	cp template/mkapex $(INSTALL_TEMP)bin/ && chmod +x $(INSTALL_TEMP)bin/mkapex

$(INSTALL_TEMP)bin: | $(INSTALL_TEMP)
	mkdir -p $(INSTALL_TEMP)bin
